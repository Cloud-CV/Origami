import re
from pprint import pprint
def find_sub_string(title, brand, conf_dict=None):
    '''
    title:
    conf_dict:
    brand_exists:
    @returns:
    '''
    if not conf_dict:
        conf_dict = model_dict
    
    if brand in title:
        match_span = re.search(brand, title, re.I).span()
        recur_match(title[(span[1] + 1):], model_dict[brand])
    else:
        recur_match(title, model_dict[brand])


def nested_dict_values(d):
  if(isinstance(d,dict)):
    for v in d.values():
        if isinstance(v, dict):
            yield from nested_dict_values(v)
        else:
            yield v
  else:
    yield d

def check(a,b,depth):
    global gvalue
    value=0
    min_start=999999
    min_end=9999999
    max_d=0
    lvl_d=0
    key=0
    span=(99999,999999)
    for k, v in a.items():
        if(k not in b):
            continue
        if(b[k][1]!=None):
            if(type(b[k][1]) == dict):                
              l=check(a[k],b[k][1],depth+1)
              if(l[1]==max_d):
                if(l[3][0]<span[0] or l[3][1]<span[1]):
                  span=(l[3][0],l[3][1])
                  value=l[0]
                  key=l[2]        
              if(l[1]>max_d):
                max_d=l[1]
                value=l[0]
                key=l[2]
                span=l[3]

        else:
            if(depth>max_d):
              max_d=depth
              value=a[k]
              key=k
              span=b[k][0]

    return (value,max_d,key,span)

def recur_match(string, dic):
    '''
    @returns:
        - dict with keys that match
          and values as tuple, substring
    '''
#     span = map(lambda x, y: (x, re.search(x, y, re.I).span()), zip(dic.keys(), it.repeat(string)))
    span_dict = {x: (y, z) for x, y, z in map(lambda x: (x,
                                                             re.search(x, string).span() if re.search(x, string) else None,
                                                             string[re.search(x, string).end():] if re.search(x, string) else None),
                                                  dic.keys()) if y}

    fin={}
    for key, value in span_dict.items():
        try:
            fin[key]=(value[0],recur_match(value[1], dic[key]))
        except:
            fin[key]=(value[0], recur_match(value[1], {}))
    if span_dict:
        return fin
    

with open('adds.txt','r') as f:
    for line in f:
      print("line ==",line)
      break


string = '4G Volte SAMSUNG Galaxy NXT 2 GB RAM 16 ROM No'

aa={'samsung': {'a3': 12074.0,
             'a5': 15130.0,
             'a6': {'plus': 22990.0, '~': 18990.0},
             'a7': 21389.0,
             'a8': {'plus': 30990.0, '~': 26499.0},
             'a9': {'pro': 31000.0},
             'ace': {'3': 8190.0,
                     'dous': {'i': {'589': 15500.0}},
                     'duos': {'s6802': 5999.0, '~': 9054.0},
                     'nxt': 4880.0,
                     'plus': {'s7500': 8000.0},
                     's5830': 7099.0},
             'alpha': 20999.0,
             'b310': 1770.0,
             'b351': 2800.0,
             'c3010': 1754.0,
             'c3011': 2324.0,
             'c7': {'pro': 21200.0},
             'c9': {'pro': 24994.0},
             'champ': {'deluxe': {'duos': 3003.0},
                       'duos': {'e2652': 3815.0},
                       'neo': {'duos': {'c3262': 4425.0}}},
             'chat': 7215.0,
             'corby': {'ii': {'s3850': 4990.0}, 'txt': {'b3210': 4108.0}},
             'core': {'2': 5900.0, 'prime': 4990.0, '~': 9999.0},
             'e1200': 1100.0,
             'e1205': 3419.0,
             'e2202': 1956.0,
             'e5': 11375.0,
             'e7': 15000.0,
             'fame': 5999.0,
             'fit': {'s5670': 5490.0},
             'g361h': 7999.0,
             'galaxy': {'a3': 12074.0,
                        'a5': 15130.0,
                        'a6': {'plus': 22990.0, '~': 18990.0},
                        'a7': 21389.0,
                        'a8': {'plus': 30990.0, '~': 26499.0},
                        'a9': {'pro': 31000.0},
                        'ace': {'3': 8190.0,
                                'dous': {'i': {'589': 15500.0}},
                                'duos': {'s6802': 5999.0, '~': 9054.0},
                                'nxt': 4880.0,
                                'plus': {'s7500': 8000.0},
                                's5830': 7099.0},
                        'alpha': 20999.0,
                        'c7': {'pro': 21200.0},
                        'c9': {'pro': 24994.0},
                        'chat': 7215.0,
                        'core': {'2': 5900.0, 'prime': 4990.0, '~': 9999.0},
                        'e5': 11375.0,
                        'e7': 15000.0,
                        'fame': 5999.0,
                        'fit': {'s5670': 5490.0},
                        'grand': {'2': 17999.0,
                                  'duos': 12699.0,
                                  'max': 11049.0,
                                  'neo': {'plus': 5999.0, '~': 5499.0},
                                  'prime': {'4g': 11999.0, '~': 8990.0},
                                  'quattro': 8000.0},
                        'j': {'max': 11900.0},
                        'j1': {'4g': 5799.0, 'ace': 5570.0, '~': 5553.0},
                        'j2': {'ace': 6550.0, 'pro': 7580.0, '~': 6433.0},
                        'j3': {'pro': 7490.0},
                        'j4': {'32': 11990.0, '~': 9990.0},
                        'j5': {'prime': {'32': 10749.0, '~': 10580.0},
                               '~': 11151.0},
                        'j6': 12490.0,
                        'j7': {'duo': 14989.0,
                               'max': 14199.0,
                               'nxt': {'3': 10893.0, '~': 9049.0},
                               'prime': {'2': 12900.0,
                                         '32': 12120.0,
                                         '~': 13400.0},
                               'pro': 16880.0,
                               '~': 9980.0},
                        'k': {'zoom': 26999.0},
                        'mega': {'2': {'8': 24000.0, '~': 16599.0},
                                 '5.8': {'i9152': 15900.0},
                                 '6.3': {'i9200': 21490.0}},
                        'music': {'duos': 6725.0},
                        'note': {'2': 24927.0,
                                 '3': {'neo': 23500.0, '~': 37127.0},
                                 '4': 27990.0,
                                 '5': {'64': 55490.0,
                                       'dual': 36999.0,
                                       '~': 45999.0},
                                 '8': 51900.0,
                                 'edge': 49990.0,
                                 '~': 19990.0},
                        'on': {'max': 13900.0,
                               'nxt': {'16': 9699.0,
                                       '64': 12899.0,
                                       '~': 15900.0}},
                        'on5': {'pro': 6950.0, '~': 6900.0},
                        'on7': {'prime': {'4': 13990.0, '~': 11990.0},
                                'pro': 7490.0,
                                '~': 10990.0},
                        'on8': 11090.0,
                        'pocket': {'neo': 5099.0, '~': 6357.0},
                        'pop': {'plus': {'s5570i': 7718.0}},
                        's': {'advance': {'i9070': 5999.0},
                              'duos': {'2': 5999.0,
                                       '3': 6048.0,
                                       '3-ve': 4449.0,
                                       '~': 8786.0},
                              'plus': {'i9001': 8899.0}},
                        's2': {'i9100': 16450.0, 'plus': 22442.0},
                        's3': {'i9300': {'32': 37150.0},
                               'mini': {'ve': 11490.0},
                               'neo': 9999.0,
                               '~': 9999.0},
                        's4': {'mini': 13608.0,
                               'zoom': 22500.0,
                               '~': 15999.0},
                        's5': {'mini': {'duos': 15999.0}, '~': 21999.0},
                        's6': {'64': 35900.0,
                               'edge': {'64': 45600.0,
                                        'plus': 54900.0,
                                        '~': 37299.0},
                               '~': 32289.0},
                        's7': {'edge': {'128': 41900.0, '~': 32900.0},
                               '~': 27990.0},
                        's8': {'plus': {'128': 66250.0, '~': 43990.0},
                               '~': 37990.0},
                        's9': {'128': 60000.0,
                               '256': 65900.0,
                               'plus': {'128': 66000.0,
                                        '256': 71000.0,
                                        '~': 59999.0},
                               '~': 51649.0},
                        'star': {'2': 4490.0,
                                 'advance': {'g350e': 3999.0},
                                 'pro': {'duos': 4450.0},
                                 '~': 3458.0},
                        'trend': {'duos': {'s7392': 4999.0}},
                        'xcover': {'2': 15000.0},
                        'y': {'duos': {'lite': 6700.0, 's6102': 10490.0},
                              'plus': {'s5303': 5016.0},
                              'pro': {'duos': {'b5512': 8982.0}},
                              's5360': 8150.0},
                        'young': 5499.0},
             'grand': {'2': 17999.0,
                       'duos': 12699.0,
                       'max': 11049.0,
                       'neo': {'plus': 5999.0, '~': 5499.0},
                       'prime': {'4g': 11999.0, '~': 8990.0},
                       'quattro': 8000.0},
             'guru': {'1200': 1100.0,
                      'b110': 1510.0,
                      'dual': {'26': {'e1252': 1748.0}},
                      'e1081': 991.0,
                      'e1160i': 1361.0,
                      'e1207': 1450.0,
                      'fm': {'plus': 1365.0},
                      'music': {'2': 1625.0, 'e1282': 1743.0},
                      'plus': 1590.0},
             'hero': {'e3213': 3196.0, 'music': {'e1232b': 1556.0}},
             'j': {'max': 11900.0},
             'j1': {'4g': 5799.0, 'ace': 5570.0, '~': 5553.0},
             'j2': {'ace': 6550.0, 'pro': 7580.0, '~': 6433.0},
             'j3': {'pro': 7490.0},
             'j4': {'32': 11990.0, '~': 9990.0},
             'j5': {'prime': {'32': 10749.0, '~': 10580.0}, '~': 11151.0},
             'j6': 12490.0,
             'j7': {'duo': 14989.0,
                    'max': 14199.0,
                    'nxt': {'3': 10893.0, '~': 9049.0},
                    'prime': {'2': 12900.0, '32': 12120.0, '~': 13400.0},
                    'pro': 16880.0,
                    '~': 9980.0},
             'k': {'zoom': 26999.0},
             'mega': {'2': {'8': 24000.0, '~': 16599.0},
                      '5.8': {'i9152': 15900.0},
                      '6.3': {'i9200': 21490.0}},
             'metro': {'313': 2025.0,
                       'b312e': 2115.0,
                       'b350e': 2800.0,
                       'c3520': 3159.0,
                       'duos': {'c3322': 7000.0},
                       'e2252': 2695.0,
                       'xl': 3190.0},
             'music': {'duos': 6725.0},
             'note': {'2': 24927.0,
                      '3': {'neo': 23500.0, '~': 37127.0},
                      '4': 27990.0,
                      '5': {'64': 55490.0, 'dual': 36999.0, '~': 45999.0},
                      '8': 51900.0,
                      'edge': 49990.0,
                      '~': 19990.0},
             'omnia': {'m': 16039.0},
             'on': {'max': 13900.0,
                    'nxt': {'16': 9699.0, '64': 12899.0, '~': 15900.0}},
             'on5': {'pro': 6950.0, '~': 6900.0},
             'on7': {'prime': {'4': 13990.0, '~': 11990.0},
                     'pro': 7490.0,
                     '~': 10990.0},
             'on8': 11090.0,
             'pocket': {'neo': 5099.0, '~': 6357.0},
             'pop': {'plus': {'s5570i': 7718.0}},
             'rex': {'60': 3243.0,
                     '70': {'s3802': 4022.0},
                     '80': 4613.0,
                     '90': 5450.0},
             's': {'advance': {'i9070': 5999.0},
                   'duos': {'2': 5999.0,
                            '3': 6048.0,
                            '3-ve': 4449.0,
                            '~': 8786.0},
                   'plus': {'i9001': 8899.0}},
             's2': {'i9100': 16450.0, 'plus': 22442.0},
             's3': {'i9300': {'32': 37150.0},
                    'mini': {'ve': 11490.0},
                    'neo': 9999.0,
                    '~': 9999.0},
             's4': {'mini': 13608.0, 'zoom': 22500.0, '~': 15999.0},
             's5': {'mini': {'duos': 15999.0}, '~': 21999.0},
             's5333': {'wave333': 7207.0},
             's6': {'64': 35900.0,
                    'edge': {'64': 45600.0, 'plus': 54900.0, '~': 37299.0},
                    '~': 32289.0},
             's7': {'edge': {'128': 41900.0, '~': 32900.0}, '~': 27990.0},
             's8': {'plus': {'128': 66250.0, '~': 43990.0}, '~': 37990.0},
             's9': {'128': 60000.0,
                    '256': 65900.0,
                    'plus': {'128': 66000.0, '256': 71000.0, '~': 59999.0},
                    '~': 51649.0},
             'star': {'2': 4490.0,
                      'advance': {'g350e': 3999.0},
                      'pro': {'duos': 4450.0},
                      '~': 3458.0},
             'trend': {'duos': {'s7392': 4999.0}},
             'wave': {'3': {'s8600': 16093.0},
                      '575': {'s5753': 5667.0},
                      'ii': {'s8530': 14492.0},
                      'y': {'s5380': 5803.0}},
             'wave525': {'s5253': 4990.0},
             'xcover': {'2': 15000.0},
             'y': {'duos': {'lite': 6700.0, 's6102': 10490.0},
                   'plus': {'s5303': 5016.0},
                   'pro': {'duos': {'b5512': 8982.0}},
                   's5360': 8150.0},
             'young': 5499.0,
             'z1': {'tizen': 4212.0},
             'z2': 3499.0,
             'z3': 7558.0,
             'z4': 4599.0}}






b=recur_match(string.lower(),aa)
v=check(aa,b,0)
print("v[0",v[0])
print("final =");
c=nested_dict_values(v[0])
cnt=0
su=0
for i in c:
  su=su+i
  cnt=cnt+1
print(su/cnt)  






